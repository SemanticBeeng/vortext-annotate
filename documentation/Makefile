STYLES=../../styles/springer-lncs/

DIAGRAMS=$(wildcard */*.uml)
EPS=$(wildcard */*.eps)

IMAGES = $(patsubst %.uml,%.eps,$(DIAGRAMS))
PDF_IMAGES = $(patsubst %.eps,%.pdf,$(EPS))

TARGET=paper.pdf

LL=latexmk -bibtex -pdf -latexoption=-shell-escape
CLEAN=latexmk -C

all: revision.tex $(TARGET)

clean:
	$(CLEAN)
	rm -f revision.tex

.PHONY: all clean

revision.tex:
	echo "% Autogenerated, do not edit" > revision.tex
	echo "\\\\newcommand{\\\\revisiondate}{`git log -1 --format=\"%ad\" --date=short`}" >> revision.tex
	echo "\\\\newcommand{\\\\revision}{`git log -1 --format=\"%h\"`}" >> revision.tex

$(TARGET): $(TARGET:%.pdf=%.tex) $(SRC)
	BSTINPUTS=$(STYLES) TEXINPUTS=$(STYLES): $(LL) $<

$(TARGET): $(IMAGES) $(PDF_IMAGES)

%.pdf: %.eps
	ps2pdf -dEPSCrop $< $@

%.eps: %.uml
	plantuml -teps $< $@
