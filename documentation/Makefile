DIAGRAMS=$(wildcard diagrams/*.uml)
IMAGES = $(patsubst %.uml,%.eps,$(DIAGRAMS))
STYLES=../../styles/springer-lncs/

TARGET=paper.pdf

LL=latexmk -bibtex -pdf -latexoption=-shell-escape -f
CLEAN=latexmk -C

all: revision.tex $(TARGET)

clean:
	$(CLEAN)
	rm -f revision.tex

.PHONY: all clean

revision.tex:
	echo "% Autogenerated, do not edit" > revision.tex
	echo "\\\\newcommand{\\\\revisiondate}{`git log -1 --format=\"%ad\" --date=short`}" >> revision.tex
	echo "\\\\newcommand{\\\\revision}{`git log -1 --format=\"%h\"`}" >> revision.tex

$(TARGET): $(TARGET:%.pdf=%.tex) $(SRC)
	BSTINPUTS=$(STYLES) TEXINPUTS=$(STYLES): $(LL) $<

$(TARGET): $(IMAGES)

images/%.pdf: images/%.eps
	ps2pdf -dEPSCrop $< $@

diagrams/%.eps: diagrams/%.uml
	plantuml -teps $< $@
